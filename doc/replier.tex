\documentclass{book}
\usepackage{sstdef}
\title{replier}
\begin{document}
\section{The \cmd{replier} program}

\subsection{Interface}
In \cmd{.qmail}:
\begin{code}%
  | replier \var{dir} \var{address} \var{prog}
\end{code}
where \cvar{dir} is a directory, \cvar{address} is an email address,
and \cvar{prog} is one or more arguments specifying a program to run.

For each email message it processes, \cmd{replier} changes the working
directory to \cvar{dir}, executes \cvar{prog} with the same message on
standard input, and forwards the standard output from \cvar{prog} to
\cvar{address}.

\cmd{replier} adds a \cmd{Mailing-List} field to the message
headers with the contents of \cmd{\var{dir}/mailinglist}.  It rejects the
message if there is already a \cmd{Mailing-List} field.

\cmd{replier} adds to the message all fields listed in
\cmd{\var{dir}/headeradd}, followed by an appropriate
\cmd{Delivered-To} line.  \cmd{replier} deletes from the message
any fields with names listed in \cmd{\var{dir}/headerremove}.
\cmd{replier} performs its header editing on the output from
\cmd{prog}.

If \cmd{prog} exits 0, then \cmd{replier} forwards the message to
\cvar{address} and exits 99, so that further commands in \cmd{.qmail}
are ignored.  If \cmd{prog} exits 111, \cmd{replier} exits 111, so
that delivery is retried later.  If \cmd{prog} exits anything else, or
does not exist, \cmd{condtomaildir} exits 0, so the rest of
\cmd{.qmail} is processed.

If it encounters a permanent error in handling a message,
\cmd{replier} exits 100.  If it encounters a temporary error a
message, \cmd{822headerfilter} exits 111.


\cmd{replier} does not distribute bounce messages: if the environment
variable \cmd{\$SENDER} is set, and is either empty or \cmd{\#@[]},
then \cmd{replier} rejects the message.

To create a replier that handles email sent to an address, use
\cmd{replier-config}.


\subsection{Environment variables}
\cmd{replier} supplies several environment variables to \cmd{prog}.
The recipient address that caused message processing by \cmd{replier}
has one of two forms: \cmd{\var{inlocal}-\var{request}@\var{domain}},
where \cvar{inlocal} matches the first line of
\cmd{\var{dir}/inlocal}, or \cmd{\var{request}@\var{domain}}, when
\cmd{\var{dir}/inlocal} has an empty first line.  In either case,
\cmd{replier} sets the following environment variables:

\textbf{NB}: These environment variables are not quoted.  They
are under the control of the sender.


\cmd{\$REQUEST} is \cvar{request} in the recipient address.

\cmd{\$REQUEST2} is the portion of \cvar{request} in the recipient
address that follows the first hyphen.

\cmd{\$REQUEST3} is the portion of \cvar{request} in the recipient
address that follows the second hyphen.

\cmd{\$REQUEST4} is the portion of \cvar{request} in the recipient
address that follows the third hyphen.
\end{document}
